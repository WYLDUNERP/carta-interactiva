<!DOCTYPE html>
<html>
<head>
<title>Una Carta Para Ti</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');

  body {
    font-family: 'Montserrat', sans-serif;
    text-align: center;
    background: linear-gradient(to right, #ffafbd, #ffc3a0);
    color: #333;
    overflow: hidden;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  #container {
    background: rgba(0, 0, 0, 0.5);
    padding: 40px;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  }

  #stitch {
    width: 200px;
    cursor: pointer;
    transition: transform 0.3s;
  }

  #stitch:hover {
    transform: scale(1.1);
  }

  #carta {
    width: 80%;
    margin: 20px auto;
    text-align: center;
    border: none;
    padding: 20px;
    display: block;
    background: white;
    color: #333;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    transform-style: preserve-3d;
    transition: transform 1s;
  }

  #carta.abierta {
    transform: rotateY(180deg);
  }

  .pagina p {
    border-right: 0.15em solid orange;
    white-space: pre;
    overflow: hidden;
  }

  .pagina.activa {
    display: block;
  }

  #lienzo-animacion {
    display: none;
    width: 100%;
    height: 500px;
    animation: fadeIn 1s;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  button {
    background: #ff7e5f;
    color: white;
    border: none;
    padding: 15px 30px;
    font-size: 1.2em;
    border-radius: 25px;
    cursor: pointer;
    transition: background 0.3s, transform 0.3s;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  }

  button:hover {
    background: #feb47b;
    transform: translateY(-3px);
  }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>

<div id="container">
  <div id="carta">
    <div class="pagina pagina-trasera">
      <p style="animation-delay: 0s;">Hola Yadirá.</p>
      <p style="animation-delay: 2.5s;">No sé si esto sea raro, pero quería hacerte llegar algo distinto.</p>
      <p style="animation-delay: 5s;">No es para impresionarte, solo para mostrarte una parte sincera de mí.</p>
      <p style="animation-delay: 7.5s;">No es presión, solo intención.</p>
      <button onclick="iniciarAnimacion()" style="animation-delay: 10s;">Descubrir la sorpresa</button>
    </div>
  </div>

  <canvas id="lienzo-animacion"></canvas>
</div>

<script>
  function typeWriter(element, text, i, callback) {
    if (i < text.length) {
      element.innerHTML = text.substring(0, i + 1) + '<span class="caret"></span>';
      setTimeout(() => typeWriter(element, text, i + 1, callback), 50);
    } else if (callback) {
      element.innerHTML = text; // Remove caret
      callback();
    }
  }

  function startTyping() {
    const paragraphs = document.querySelectorAll('.pagina-trasera p');
    let pIndex = 0;

    function typeNextParagraph() {
      if (pIndex < paragraphs.length) {
        const p = paragraphs[pIndex];
        const text = p.getAttribute('data-text');
        p.style.display = 'block';
        typeWriter(p, text, 0, () => {
          pIndex++;
          setTimeout(typeNextParagraph, 500); // Delay between paragraphs
        });
      } else {
        document.querySelector('.pagina-trasera button').style.display = 'block';
      }
    }

    typeNextParagraph();
  }

  function iniciarAnimacion() {
    document.getElementById('carta').style.display = 'none';
    document.getElementById('lienzo-animacion').style.display = 'block';
  }

  document.addEventListener('DOMContentLoaded', function() {
    const paragraphs = document.querySelectorAll('.pagina-trasera p');
    paragraphs.forEach(p => {
      p.setAttribute('data-text', p.innerHTML);
      p.innerHTML = '';
      p.style.display = 'none';
    });
    document.querySelector('.pagina-trasera button').style.display = 'none';

    document.getElementById('carta').addEventListener('click', function() {
      if (!this.classList.contains('abierta')) {
        this.classList.add('abierta');
        startTyping();
      }
    });

    const lienzo = document.getElementById('lienzo-animacion');
    const escena = new THREE.Scene();
    const camara = new THREE.PerspectiveCamera(75, lienzo.clientWidth / lienzo.clientHeight, 0.1, 1000);
    const renderizador = new THREE.WebGLRenderer({ canvas: lienzo, alpha: true });
    renderizador.setSize(lienzo.clientWidth, lienzo.clientHeight);

    const geometriaParticulas = new THREE.BufferGeometry();
    const vertices = [];
    const colores = [];
    const numParticulas = 15000;

    for (let i = 0; i < numParticulas; i++) {
      const t = Math.random() * 2 * Math.PI;
      const x = 16 * Math.pow(Math.sin(t), 3);
      const y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
      vertices.push(x / 12, y / 12, (Math.random() - 0.5) * 2.5);

      const color = new THREE.Color();
      color.setHSL(Math.random(), 0.8, 0.6);
      colores.push(color.r, color.g, color.b);
    }

    geometriaParticulas.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
    geometriaParticulas.setAttribute('color', new THREE.Float32BufferAttribute(colores, 3));

    const materialParticulas = new THREE.PointsMaterial({
      size: 0.15,
      vertexColors: true,
      blending: THREE.AdditiveBlending,
      transparent: true,
      opacity: 0.8
    });

    const corazonParticulas = new THREE.Points(geometriaParticulas, materialParticulas);
    escena.add(corazonParticulas);

    const anillos = [];
    for (let i = 0; i < 7; i++) {
      const geometriaAnillo = new THREE.RingGeometry(2.5 + i * 0.6, 2.6 + i * 0.6, 128);
      const materialAnillo = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 0.08 + Math.random() * 0.05,
        transparent: true,
        opacity: 0.5
      });
      const anillo = new THREE.Points(geometriaAnillo, materialAnillo);
      anillo.rotation.x = Math.random() * Math.PI;
      anillo.rotation.y = Math.random() * Math.PI;
      anillo.userData.velocidad = (Math.random() - 0.5) * 0.008;
      escena.add(anillo);
      anillos.push(anillo);
    }

    camara.position.z = 12;

    let tiempo = 0;
    function animar() {
      requestAnimationFrame(animar);
      tiempo += 0.008;

      corazonParticulas.rotation.y += 0.002;
      corazonParticulas.scale.setScalar(1 + Math.sin(tiempo * 2.5) * 0.08);

      anillos.forEach(anillo => {
        anillo.rotation.z += anillo.userData.velocidad;
      });

      renderizador.render(escena, camara);
    }

    animar();
  });
</script>

</body>
</html>
